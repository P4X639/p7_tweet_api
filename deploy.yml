# Configuration pour Azure Container App ou App Service

# Variables d'environnement pour Azure
environment:
  - name: PORT
    value: "80"
  - name: PYTHONUNBUFFERED
    value: "1"
  - name: DAGSHUB_USERNAME
    value: "dev.nono.stargate"
  - name: DAGSHUB_TOKEN
    secretRef: dagshub-token  # À configurer dans Azure Key Vault
  - name: MLFLOW_TRACKING_USERNAME
    value: "dev.nono.stargate"
  - name: MLFLOW_TRACKING_PASSWORD
    secretRef: dagshub-token

# Configuration des ressources
resources:
  cpu: 1.0
  memory: 2Gi

# Configuration de santé
probes:
  liveness:
    httpGet:
      path: /health
      port: 80
    initialDelaySeconds: 30
    periodSeconds: 30
  readiness:
    httpGet:
      path: /health
      port: 80
    initialDelaySeconds: 5
    periodSeconds: 10

# Scaling (pour Azure Container Apps)
scale:
  minReplicas: 1
  maxReplicas: 3
  rules:
    - name: cpu-scaling
      custom:
        type: cpu
        metadata:
          type: Utilization
          value: "70"